<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>sentinel</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“¡</text></svg>">
</head>
<body>

  <!-- CRT Scanline Overlay -->
  <div id="crt-overlay"></div>

  <!-- â•â•â• LANDING PAGE â•â•â• -->
  <div id="landing" class="landing">
    <canvas id="landing-radar" class="landing-radar"></canvas>
    <svg id="landing-map" class="landing-map" viewBox="0 0 1000 500" preserveAspectRatio="xMidYMid meet">
      <!-- Simplified world continents as green wireframe paths -->
      <g stroke="var(--green-dark)" stroke-width="0.7" fill="none" opacity="0.35">
        <!-- North America -->
        <path d="M150,80 L180,70 L220,65 L250,80 L260,100 L255,130 L240,150 L230,160 L210,170 L200,190 L190,200 L180,210 L170,195 L165,180 L155,165 L140,160 L130,150 L120,140 L115,125 L120,105 L135,90 Z"/>
        <path d="M200,190 L210,200 L225,210 L220,225 L210,230 L200,220 L195,210 Z"/>
        <!-- South America -->
        <path d="M220,240 L235,235 L250,240 L260,255 L270,275 L275,300 L270,330 L260,355 L250,375 L240,385 L235,380 L230,360 L225,335 L220,310 L215,285 L210,265 L215,250 Z"/>
        <!-- Europe -->
        <path d="M440,75 L460,70 L480,72 L500,80 L510,90 L505,100 L495,110 L485,115 L470,118 L460,115 L450,105 L445,95 L440,85 Z"/>
        <!-- Africa -->
        <path d="M450,140 L470,135 L490,140 L505,155 L510,175 L515,200 L510,230 L500,255 L490,275 L475,285 L460,280 L450,265 L445,245 L440,220 L435,195 L440,170 L445,155 Z"/>
        <!-- Asia -->
        <path d="M520,60 L560,50 L600,45 L650,50 L700,60 L730,75 L750,90 L760,110 L755,130 L740,145 L720,150 L700,148 L680,140 L660,135 L640,130 L620,125 L600,120 L580,110 L560,100 L540,90 L530,80 Z"/>
        <path d="M560,100 L570,120 L565,140 L555,155 L540,160 L530,150 L525,135 L530,120 L540,110 Z"/>
        <!-- Australia -->
        <path d="M720,260 L750,255 L780,260 L800,275 L805,295 L795,310 L775,315 L755,310 L740,300 L730,285 L725,270 Z"/>
        <!-- Scattered Islands / Detail dots -->
        <circle cx="680" cy="185" r="3"/>
        <circle cx="700" cy="200" r="2"/>
        <circle cx="760" cy="170" r="4"/>
      </g>
      <!-- Glowing ping dots on key locations -->
      <g class="landing-pings">
        <circle cx="200" cy="140" r="2.5" fill="var(--green)" opacity="0"><animate attributeName="opacity" values="0;0.8;0" dur="3s" repeatCount="indefinite" begin="0s"/><animate attributeName="r" values="2;5;2" dur="3s" repeatCount="indefinite" begin="0s"/></circle>
        <circle cx="470" cy="100" r="2.5" fill="var(--green)" opacity="0"><animate attributeName="opacity" values="0;0.8;0" dur="3s" repeatCount="indefinite" begin="1s"/><animate attributeName="r" values="2;5;2" dur="3s" repeatCount="indefinite" begin="1s"/></circle>
        <circle cx="640" cy="80" r="2.5" fill="var(--green)" opacity="0"><animate attributeName="opacity" values="0;0.8;0" dur="3s" repeatCount="indefinite" begin="0.5s"/><animate attributeName="r" values="2;5;2" dur="3s" repeatCount="indefinite" begin="0.5s"/></circle>
        <circle cx="480" cy="200" r="2.5" fill="var(--green)" opacity="0"><animate attributeName="opacity" values="0;0.8;0" dur="3s" repeatCount="indefinite" begin="1.8s"/><animate attributeName="r" values="2;5;2" dur="3s" repeatCount="indefinite" begin="1.8s"/></circle>
        <circle cx="760" cy="280" r="2.5" fill="var(--green)" opacity="0"><animate attributeName="opacity" values="0;0.8;0" dur="3s" repeatCount="indefinite" begin="2.3s"/><animate attributeName="r" values="2;5;2" dur="3s" repeatCount="indefinite" begin="2.3s"/></circle>
        <circle cx="260" cy="300" r="2.5" fill="var(--green)" opacity="0"><animate attributeName="opacity" values="0;0.8;0" dur="3s" repeatCount="indefinite" begin="0.8s"/><animate attributeName="r" values="2;5;2" dur="3s" repeatCount="indefinite" begin="0.8s"/></circle>
      </g>
    </svg>

    <div class="landing-content">
      <div class="landing-left">
        <div class="landing-logo">â–“ SENTINEL</div>
        <div class="landing-tagline">
          <span class="landing-line" style="animation-delay: 0.3s">The truth doesn't wait for permission.</span>
          <span class="landing-line" style="animation-delay: 0.8s">It doesn't care who's comfortable.</span>
          <span class="landing-line" style="animation-delay: 1.3s">It just needs someone paying attention.</span>
        </div>
        <p class="landing-sub" style="animation-delay: 2s">
          Real-time intelligence from every corner of the open web.<br>
          No algorithm decides what you see. No paywall decides who knows.<br>
          <span class="landing-accent">Information is a right, not a privilege.</span>
        </p>
      </div>
      <div class="landing-right">
        <button id="landing-enter" class="landing-cta">
          <span class="cta-icon">â—‰</span>
          <span class="cta-text">ENTER SENTINEL</span>
          <span class="cta-arrow">â–¸</span>
        </button>
        <div class="landing-hint">press ENTER or click to begin</div>
      </div>
    </div>
  </div>

  <!-- â•â•â• HEADER â•â•â• -->
  <header id="header">
    <div class="header-left">
      <span class="logo">â–“ SENTINEL</span>
      <span class="version">v1.0</span>
    </div>
    <nav id="nav-desktop">
      <button class="nav-btn active" data-view="radar" title="Radar view (R)">â—‰ RADAR</button>
      <button class="nav-btn" data-view="feed" title="Feed view (F)">â‰¡ FEED</button>
      <button class="nav-btn" data-view="map" title="Map view (M)">âŠ• MAP</button>
      <button class="nav-btn" data-view="saved" title="Saved items (S)">â˜… SAVED</button>
    </nav>
    <div class="header-right">
      <div class="search-box">
        <input type="text" id="search-input" placeholder="/ SEARCH..." autocomplete="off" spellcheck="false">
      </div>
      <button id="mute-btn" class="icon-btn" title="Toggle radar sound">ğŸ”Š</button>
      <button id="refresh-btn" class="icon-btn" title="Refresh now">âŸ³</button>
      <button id="settings-btn" class="icon-btn" title="Settings">âš™</button>
      <button id="auth-btn" class="icon-btn" title="Sign in">ğŸ‘¤</button>
    </div>
  </header>

  <!-- â•â•â• FILTER BAR â•â•â• -->
  <div id="filter-bar">
    <div class="filters">
      <button class="filter-btn active" data-category="all">ALL</button>
      <button class="filter-btn" data-category="technology">TECH</button>
      <button class="filter-btn" data-category="politics">POLITICS</button>
      <button class="filter-btn" data-category="science">SCIENCE</button>
      <button class="filter-btn" data-category="business">BUSINESS</button>
      <button class="filter-btn" data-category="entertainment">ENTERTAIN</button>
      <button class="filter-btn" data-category="sports">SPORTS</button>
      <button class="filter-btn" data-category="world">WORLD</button>
      <button class="filter-btn" data-category="community">COMMUNITY</button>
    </div>
    <div class="source-filters">
      <label class="source-toggle"><input type="checkbox" data-source="reddit" checked> Reddit</label>
      <label class="source-toggle"><input type="checkbox" data-source="hackernews" checked> HN</label>
      <label class="source-toggle"><input type="checkbox" data-source="rss" checked> RSS</label>
      <label class="source-toggle"><input type="checkbox" data-source="newsapi" checked> NewsAPI</label>
      <label class="source-toggle"><input type="checkbox" data-source="guardian" checked> Guardian</label>
      <label class="source-toggle"><input type="checkbox" data-source="wikinews" checked> WikiNews</label>
      <label class="source-toggle"><input type="checkbox" data-source="thenewsapi" checked> TheNewsAPI</label>
    </div>
  </div>

  <!-- â•â•â• MAIN CONTENT â•â•â• -->
  <main id="main">

    <!-- RADAR VIEW -->
    <div id="view-radar" class="view active">
      <canvas id="radar-canvas"></canvas>
      <div id="radar-tooltip" class="tooltip hidden"></div>
      <div id="radar-info">
        <span id="radar-count">Scanning...</span>
      </div>
    </div>

    <!-- FEED VIEW -->
    <div id="view-feed" class="view">
      <div id="feed-container">
        <div id="feed-list"></div>
        <div id="feed-loading" class="loading">SCANNING FREQUENCIES...</div>
        <button id="feed-load-more" class="load-more hidden">â–¼ LOAD MORE SIGNALS â–¼</button>
      </div>
    </div>

    <!-- MAP VIEW -->
    <div id="view-map" class="view">
      <div id="map-container"></div>
      <div id="map-info">
        <span id="map-count">Triangulating...</span>
      </div>
    </div>

    <!-- SAVED VIEW -->
    <div id="view-saved" class="view">
      <div id="saved-container">
        <div id="saved-header">
          <h2>â˜… SAVED INTELLIGENCE</h2>
          <button id="clear-saved" class="btn-sm">PURGE ALL</button>
        </div>
        <div id="saved-list"></div>
        <div id="saved-empty" class="empty-state">
          <p>[ NO SAVED INTEL ]</p>
          <p class="hint">Bookmark articles from any view to cache them here.</p>
        </div>
      </div>
    </div>

  </main>

  <!-- â•â•â• ARTICLE DETAIL PANEL â•â•â• -->
  <div id="detail-overlay" class="overlay hidden"></div>
  <div id="detail-panel" class="side-panel hidden">
    <div class="panel-header">
      <span class="panel-badge" id="detail-source"></span>
      <span class="panel-badge" id="detail-category"></span>
      <button id="detail-close" class="icon-btn" title="Close (Esc)">âœ•</button>
    </div>
    <div class="panel-body">
      <h2 id="detail-title"></h2>
      <div class="detail-meta">
        <span id="detail-author"></span>
        <span id="detail-time"></span>
        <span id="detail-score"></span>
      </div>
      <img id="detail-image" class="detail-img hidden" alt="">
      <p id="detail-snippet"></p>
      <div class="detail-actions">
        <a id="detail-link" href="#" target="_blank" rel="noopener" class="btn">OPEN SOURCE â†—</a>
        <a id="detail-comments-link" href="#" target="_blank" rel="noopener" class="btn btn-outline">DISCUSSION â†—</a>
        <button id="detail-save" class="btn btn-outline">â˜† SAVE</button>
        <button id="detail-share" class="btn btn-outline" title="Share / Copy link">â˜ SHARE</button>
      </div>
      <div class="detail-reactions">
        <button id="detail-like" class="react-btn" title="Like â€” boost similar content">ğŸ‘ LIKE</button>
        <button id="detail-dislike" class="react-btn" title="Dislike â€” show less like this">ğŸ‘ DISLIKE</button>
        <button id="detail-showless" class="react-btn" title="Show less from this source">ğŸ“‰ SHOW LESS</button>
        <button id="detail-block" class="react-btn react-danger" title="Block â€” never show again">ğŸš« BLOCK</button>
      </div>
      <div id="detail-discussion" class="detail-discussion">
        <h3 class="discussion-header">ğŸ’¬ DISCUSSION</h3>
        <div id="discussion-loading" class="discussion-loading hidden">Scanning threads...</div>
        <div id="discussion-list" class="discussion-list"></div>
        <div id="discussion-empty" class="discussion-empty hidden">No discussion data available for this source.</div>
      </div>
    </div>
  </div>

  <!-- â•â•â• SETTINGS PANEL â•â•â• -->
  <div id="settings-overlay" class="overlay hidden"></div>
  <div id="settings-panel" class="side-panel hidden">
    <div class="panel-header">
      <h2>âš™ CONFIGURATION</h2>
      <button id="settings-close" class="icon-btn">âœ•</button>
    </div>
    <div class="panel-body">
      <div class="setting-group">
        <label>Auto-refresh interval (seconds)</label>
        <input type="number" id="setting-refresh" value="120" min="30" max="600" step="10">
      </div>
      <div class="setting-group">
        <label>CRT Scanline Effect</label>
        <label class="switch">
          <input type="checkbox" id="setting-crt" checked>
          <span>Enabled</span>
        </label>
      </div>
      <div class="setting-group setting-account">
        <h3>ğŸ‘¤ Account</h3>
        <p class="hint" id="setting-auth-hint">Sign in to sync preferences across devices.</p>
        <button id="setting-auth-btn" class="btn">â–¸ SIGN IN / SIGN UP</button>
      </div>
      <div class="setting-group">
        <label>Radar Sound</label>
        <label class="switch">
          <input type="checkbox" id="setting-sound">
          <span>Enabled</span>
        </label>
      </div>
      <div class="setting-group">
        <label>Local News Region</label>
        <select id="setting-country">
          <option value="auto">Auto-detect</option>
          <option value="us">ğŸ‡ºğŸ‡¸ United States</option>
          <option value="gb">ğŸ‡¬ğŸ‡§ United Kingdom</option>
          <option value="ca">ğŸ‡¨ğŸ‡¦ Canada</option>
          <option value="au">ğŸ‡¦ğŸ‡º Australia</option>
          <option value="de">ğŸ‡©ğŸ‡ª Germany</option>
          <option value="fr">ğŸ‡«ğŸ‡· France</option>
          <option value="in">ğŸ‡®ğŸ‡³ India</option>
          <option value="jp">ğŸ‡¯ğŸ‡µ Japan</option>
          <option value="br">ğŸ‡§ğŸ‡· Brazil</option>
          <option value="za">ğŸ‡¿ğŸ‡¦ South Africa</option>
          <option value="ng">ğŸ‡³ğŸ‡¬ Nigeria</option>
          <option value="ae">ğŸ‡¦ğŸ‡ª UAE</option>
          <option value="sg">ğŸ‡¸ğŸ‡¬ Singapore</option>
          <option value="kr">ğŸ‡°ğŸ‡· South Korea</option>
          <option value="mx">ğŸ‡²ğŸ‡½ Mexico</option>
          <option value="it">ğŸ‡®ğŸ‡¹ Italy</option>
          <option value="es">ğŸ‡ªğŸ‡¸ Spain</option>
          <option value="nl">ğŸ‡³ğŸ‡± Netherlands</option>
          <option value="se">ğŸ‡¸ğŸ‡ª Sweden</option>
          <option value="pl">ğŸ‡µğŸ‡± Poland</option>
          <option value="ph">ğŸ‡µğŸ‡­ Philippines</option>
        </select>
        <p class="hint">Adds local headlines from your selected region.</p>
      </div>
      <div class="setting-group">
        <label>Radar Sweep Speed</label>
        <select id="setting-radar-speed">
          <option value="slow">Slow</option>
          <option value="normal" selected>Normal</option>
          <option value="fast">Fast</option>
        </select>
      </div>
      <div class="setting-group">
        <h3>ğŸ“¡ Subreddit Sources</h3>
        <p class="hint">Toggle subreddits to tailor your feed. More subs = more signals.</p>
        <div class="sub-counter"><span id="sub-count">0</span> active sources</div>
        <div id="sub-manager"></div>
        <div class="sub-custom-add">
          <input type="text" id="sub-custom-input" placeholder="r/subreddit" spellcheck="false" autocomplete="off">
          <button id="sub-custom-btn" class="btn">+ ADD</button>
        </div>
      </div>
      <div class="setting-group">
        <h3>Interest Profile</h3>
        <p class="hint">Your click patterns shape the ranking algorithm</p>
        <div id="interest-chart"></div>
      </div>
      <div class="setting-group">
        <h3>Keyboard Shortcuts</h3>
        <div class="shortcuts-list">
          <div><kbd>R</kbd> Radar view</div>
          <div><kbd>F</kbd> Feed view</div>
          <div><kbd>M</kbd> Map view</div>
          <div><kbd>S</kbd> Saved view</div>
          <div><kbd>/</kbd> Focus search</div>
          <div><kbd>Esc</kbd> Close panels</div>
        </div>
      </div>

      <div class="setting-group">
        <button id="setting-clear-data" class="btn btn-danger">âš  WIPE ALL LOCAL DATA</button>
      </div>
    </div>
  </div>

  <!-- â•â•â• AUTH MODAL â•â•â• -->
  <div id="auth-overlay" class="overlay hidden"></div>
  <div id="auth-modal" class="auth-modal hidden">
    <div class="auth-header">
      <span>â–“ AUTHENTICATE</span>
      <button id="auth-modal-close" class="icon-btn">âœ•</button>
    </div>
    <div class="auth-tabs" id="auth-tabs">
      <button class="auth-tab active" data-tab="signin">SIGN IN</button>
      <button class="auth-tab" data-tab="signup">SIGN UP</button>
    </div>
    <form id="auth-form" autocomplete="off">
      <div class="auth-field">
        <label>EMAIL</label>
        <input type="email" id="auth-email" required spellcheck="false" placeholder="operator@sentinel.io">
      </div>
      <div class="auth-field">
        <label>PASSWORD</label>
        <input type="password" id="auth-password" required minlength="6" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
      </div>
      <button type="submit" class="auth-submit">â–¸ AUTHENTICATE</button>
      <div id="auth-status" class="auth-status">> Awaiting credentials...</div>
    </form>
    <div id="auth-user-info" class="auth-user-info hidden">
      <div class="auth-user-email" id="auth-user-email"></div>
      <div class="auth-user-since" id="auth-user-since">Session active</div>
      <div class="auth-sync-label" id="auth-sync-status">â˜ Synced to cloud</div>
      <button id="auth-signout" class="btn btn-danger">â—‰ SIGN OUT</button>
    </div>
  </div>

  <!-- â•â•â• STATUS BAR â•â•â• -->
  <footer id="status-bar">
    <span id="status-connection">â— ONLINE</span>
    <span id="status-sources">Sources: â€”</span>
    <span id="status-items">Signals: â€”</span>
    <span id="status-region">Region: â€”</span>
    <span id="status-refresh">Next scan: â€”</span>
    <span id="status-time" class="status-right"></span>
  </footer>

  <!-- â•â•â• MOBILE BOTTOM NAV â•â•â• -->
  <nav id="mobile-nav">
    <button class="mobile-nav-btn active" data-view="radar">
      <span class="mnav-icon">â—‰</span>
      <span class="mnav-label">Radar</span>
    </button>
    <button class="mobile-nav-btn" data-view="feed">
      <span class="mnav-icon">â‰¡</span>
      <span class="mnav-label">Feed</span>
    </button>
    <button class="mobile-nav-btn" data-view="map">
      <span class="mnav-icon">âŠ•</span>
      <span class="mnav-label">Map</span>
    </button>
    <button class="mobile-nav-btn" data-view="saved">
      <span class="mnav-icon">â˜…</span>
      <span class="mnav-label">Saved</span>
    </button>
  </nav>

  <!-- â•â•â• SCRIPTS â•â•â• -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <!-- Landing page logic (runs before main app) -->
  <script>
  (function() {
    const SEEN_KEY = 'sentinel_seen_landing';
    const landing = document.getElementById('landing');
    const seen = localStorage.getItem(SEEN_KEY);

    if (seen) {
      // Returning user â€” skip landing entirely
      landing.classList.add('hidden');
      document.body.classList.remove('landing-active');
    } else {
      document.body.classList.add('landing-active');
      initLandingRadar();
    }

    function enterApp() {
      localStorage.setItem(SEEN_KEY, '1');
      landing.classList.add('dismissed');
      document.body.classList.remove('landing-active');
      setTimeout(() => landing.classList.add('hidden'), 650);
    }

    document.getElementById('landing-enter')?.addEventListener('click', enterApp);
    document.addEventListener('keydown', function onKey(e) {
      if (!landing.classList.contains('hidden') && !landing.classList.contains('dismissed')) {
        if (e.key === 'Enter') {
          e.preventDefault();
          enterApp();
          document.removeEventListener('keydown', onKey);
        }
      }
    });

    /* Mini radar canvas animation for the landing background */
    function initLandingRadar() {
      const c = document.getElementById('landing-radar');
      if (!c) return;
      const ctx = c.getContext('2d');
      const size = 600;
      c.width = size; c.height = size;
      let angle = 0;

      function draw() {
        if (landing.classList.contains('hidden')) return;
        const cx = size / 2, cy = size / 2, r = size * 0.46;

        ctx.clearRect(0, 0, size, size);

        // Rings
        ctx.strokeStyle = 'rgba(0,255,65,0.12)';
        ctx.lineWidth = 0.8;
        for (let i = 1; i <= 4; i++) {
          ctx.beginPath();
          ctx.arc(cx, cy, r * (i / 4), 0, Math.PI * 2);
          ctx.stroke();
        }

        // Cross hairs
        ctx.strokeStyle = 'rgba(0,255,65,0.07)';
        ctx.beginPath();
        ctx.moveTo(cx - r, cy); ctx.lineTo(cx + r, cy);
        ctx.moveTo(cx, cy - r); ctx.lineTo(cx, cy + r);
        ctx.stroke();

        // Sweep gradient
        const grad = ctx.createConicalGradient
          ? null // fallback below
          : null;

        // Sweep arc (trailing glow)
        for (let i = 0; i < 30; i++) {
          const a = angle - (i * 0.02);
          const alpha = (1 - i / 30) * 0.35;
          ctx.strokeStyle = `rgba(0,255,65,${alpha})`;
          ctx.lineWidth = 2;
          ctx.beginPath();
          ctx.moveTo(cx, cy);
          ctx.lineTo(cx + Math.cos(a) * r, cy + Math.sin(a) * r);
          ctx.stroke();
        }

        // Sweep line (bright)
        ctx.strokeStyle = 'rgba(0,255,65,0.8)';
        ctx.lineWidth = 1.5;
        ctx.beginPath();
        ctx.moveTo(cx, cy);
        ctx.lineTo(cx + Math.cos(angle) * r, cy + Math.sin(angle) * r);
        ctx.stroke();

        // Center dot
        ctx.fillStyle = 'rgba(0,255,65,0.5)';
        ctx.beginPath();
        ctx.arc(cx, cy, 3, 0, Math.PI * 2);
        ctx.fill();

        // Some fake blips
        const blips = [
          { a: 0.8, d: 0.3 }, { a: 2.1, d: 0.6 }, { a: 3.5, d: 0.45 },
          { a: 4.8, d: 0.75 }, { a: 5.5, d: 0.2 }, { a: 1.2, d: 0.85 }
        ];
        blips.forEach(b => {
          const diff = ((angle - b.a) % (Math.PI * 2) + Math.PI * 2) % (Math.PI * 2);
          const glow = diff < 0.8 ? (1 - diff / 0.8) * 0.7 : 0.15;
          ctx.fillStyle = `rgba(0,255,65,${glow})`;
          ctx.beginPath();
          ctx.arc(cx + Math.cos(b.a) * r * b.d, cy + Math.sin(b.a) * r * b.d, 3, 0, Math.PI * 2);
          ctx.fill();
        });

        angle += 0.008;
        if (angle > Math.PI * 2) angle -= Math.PI * 2;
        requestAnimationFrame(draw);
      }
      draw();
    }
  })();
  </script>

  <script src="/js/store.js"></script>
  <script src="/js/api.js"></script>
  <script src="/js/auth.js"></script>
  <script src="/js/radar.js"></script>
  <script src="/js/worldmap.js"></script>
  <script src="/js/timeline.js"></script>
  <script src="/js/app.js"></script>

</body>
</html>
