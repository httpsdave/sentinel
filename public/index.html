<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>sentinel</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“¡</text></svg>">
</head>
<body>

  <!-- CRT Scanline Overlay -->
  <div id="crt-overlay"></div>

  <!-- â•â•â• LANDING PAGE â•â•â• -->
  <div id="landing" class="landing">
    <canvas id="landing-radar" class="landing-radar"></canvas>
    <canvas id="landing-map-canvas" class="landing-map-canvas"></canvas>

    <!-- Matrix rain canvas (mobile only) -->
    <canvas id="matrix-rain" class="matrix-rain"></canvas>

    <div class="landing-content">
      <div class="landing-left">
        <div class="landing-logo">â–“ SENTINEL</div>
        <div class="landing-tagline">
          <span class="landing-line" style="animation-delay: 0.3s">The truth doesn't wait for permission.</span>
          <span class="landing-line" style="animation-delay: 0.8s">It doesn't care who's comfortable.</span>
          <span class="landing-line" style="animation-delay: 1.3s">It just needs someone paying attention.</span>
        </div>
        <p class="landing-sub" style="animation-delay: 2s">
          Real-time intelligence from every corner of the open web.<br>
          No algorithm decides what you see. No paywall decides who knows.<br>
          <span class="landing-accent">Information is a right, not a privilege.</span>
        </p>
      </div>
      <div class="landing-right">
        <button id="landing-enter" class="landing-cta">
          <span class="cta-icon">â—‰</span>
          <span class="cta-text">ENTER SENTINEL</span>
          <span class="cta-arrow">â–¸</span>
        </button>
        <div class="landing-hint">press ENTER or click to begin</div>
      </div>
    </div>
  </div>

  <!-- â•â•â• HEADER â•â•â• -->
  <header id="header">
    <div class="header-left">
      <span class="logo">â–“ SENTINEL</span>
      <span class="version">v1.0</span>
    </div>
    <nav id="nav-desktop">
      <button class="nav-btn active" data-view="radar" title="Radar view (R)">â—‰ RADAR</button>
      <button class="nav-btn" data-view="feed" title="Feed view (F)">â‰¡ FEED</button>
      <button class="nav-btn" data-view="map" title="Map view (M)">âŠ• MAP</button>
      <button class="nav-btn" data-view="calendar" title="Events (C)">â–£ EVENTS</button>
    </nav>
    <div class="header-right">
      <div class="search-box">
        <input type="text" id="search-input" placeholder="/ SEARCH..." autocomplete="off" spellcheck="false">
        <div id="search-suggestions" class="search-suggestions hidden"></div>
      </div>
      <button id="mute-btn" class="icon-btn" title="Toggle radar sound">ğŸ”Š</button>
      <button id="refresh-btn" class="icon-btn" title="Refresh now">âŸ³</button>
      <button id="settings-btn" class="icon-btn" title="Settings">âš™</button>
      <button id="auth-btn" class="icon-btn" title="Sign in">ğŸ‘¤</button>
    </div>
  </header>

  <!-- â•â•â• FILTER BAR â•â•â• -->
  <div id="filter-bar">
    <div class="filters">
      <button class="filter-btn active" data-category="all" data-short="WLD">WORLD</button>
      <button class="filter-btn" data-category="technology" data-short="TECH">TECH</button>
      <button class="filter-btn" data-category="politics" data-short="POL">POLITICS</button>
      <button class="filter-btn" data-category="science" data-short="SCI">SCIENCE</button>
      <button class="filter-btn" data-category="business" data-short="BIZ">BUSINESS</button>
      <button class="filter-btn" data-category="entertainment" data-short="ENT">ENTERTAIN</button>
      <button class="filter-btn" data-category="sports" data-short="SPT">SPORTS</button>
      <button class="filter-btn" data-category="esports" data-short="ESP">ESPORTS</button>
      <button class="filter-btn" data-category="community" data-short="COM">COMMUNITY</button>
      <button class="filter-btn filter-local hidden" data-category="local" data-short="LOC" id="filter-local">ğŸ“ LOCAL</button>
    </div>
    <div class="filter-actions">
      <div class="sort-dropdown" id="sort-dropdown">
        <button class="sort-dropdown-btn" id="sort-dropdown-btn" title="Sort order">
          <svg class="sort-icon" id="sort-icon-active" viewBox="0 0 16 16" width="14" height="14" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M8 1l2 4h4l-3.2 2.8L12 13 8 10.2 4 13l1.2-5.2L2 5h4z"/></svg>
          <span id="sort-label">RANKED</span>
          <svg class="sort-chevron" viewBox="0 0 10 6" width="8" height="5" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M1 1l4 4 4-4"/></svg>
        </button>
        <div class="sort-dropdown-menu hidden" id="sort-dropdown-menu">
          <button class="sort-option active" data-sort="ranked">
            <svg viewBox="0 0 16 16" width="14" height="14" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M8 1l2 4h4l-3.2 2.8L12 13 8 10.2 4 13l1.2-5.2L2 5h4z"/></svg>
            <span>RANKED</span>
          </button>
          <button class="sort-option" data-sort="newest">
            <svg viewBox="0 0 16 16" width="14" height="14" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M8 2v10M8 2l3 3M8 2L5 5"/><line x1="3" y1="14" x2="13" y2="14"/></svg>
            <span>NEWEST</span>
          </button>
          <button class="sort-option" data-sort="oldest">
            <svg viewBox="0 0 16 16" width="14" height="14" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M8 14V4M8 14l3-3M8 14L5 11"/><line x1="3" y1="2" x2="13" y2="2"/></svg>
            <span>OLDEST</span>
          </button>
        </div>
      </div>
      <div class="source-dropdown" id="source-dropdown">
        <button class="source-dropdown-btn" id="source-dropdown-btn" title="Filter news sources">
          <svg viewBox="0 0 16 16" width="14" height="14" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="8" r="6"/><path d="M8 2v2M8 12v2M14 8h-2M4 8H2M12.2 3.8l-1.4 1.4M5.2 10.8l-1.4 1.4M12.2 12.2l-1.4-1.4M5.2 5.2L3.8 3.8"/></svg>
          <span>SOURCES</span>
          <span class="source-count" id="source-count">8</span>
        </button>
        <div class="source-dropdown-menu hidden" id="source-dropdown-menu">
          <div class="source-dropdown-header">â—ˆ NEWS SOURCES</div>
          <label class="source-option"><input type="checkbox" data-source="reddit" checked><span class="source-dot"></span>Reddit</label>
          <label class="source-option"><input type="checkbox" data-source="hackernews" checked><span class="source-dot"></span>Hacker News</label>
          <label class="source-option"><input type="checkbox" data-source="rss" checked><span class="source-dot"></span>RSS Feeds</label>
          <label class="source-option"><input type="checkbox" data-source="newsapi" checked><span class="source-dot"></span>NewsAPI</label>
          <label class="source-option"><input type="checkbox" data-source="guardian" checked><span class="source-dot"></span>Guardian</label>
          <label class="source-option"><input type="checkbox" data-source="wikinews" checked><span class="source-dot"></span>WikiNews</label>
          <label class="source-option"><input type="checkbox" data-source="thenewsapi" checked><span class="source-dot"></span>TheNewsAPI</label>
          <label class="source-option"><input type="checkbox" data-source="gnews" checked><span class="source-dot"></span>GNews</label>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â• MAIN CONTENT â•â•â• -->
  <main id="main">

    <!-- RADAR VIEW -->
    <div id="view-radar" class="view active">
      <canvas id="radar-canvas"></canvas>
      <div id="radar-tooltip" class="tooltip hidden"></div>
      <div id="radar-info">
        <span id="radar-count">Scanning...</span>
      </div>
    </div>

    <!-- FEED VIEW -->
    <div id="view-feed" class="view">
      <div id="feed-container">
        <div id="feed-list"></div>
        <div id="feed-loading" class="loading">SCANNING FREQUENCIES...</div>
        <button id="feed-load-more" class="load-more hidden">â–¼ LOAD MORE SIGNALS â–¼</button>
      </div>
    </div>

    <!-- MAP VIEW -->
    <div id="view-map" class="view">
      <div id="map-container"></div>
      <div id="map-info">
        <span id="map-count">Triangulating...</span>
      </div>
    </div>

    <!-- CALENDAR VIEW -->
    <div id="view-calendar" class="view">
      <div id="calendar-container"></div>
    </div>

  </main>

  <!-- â•â•â• ARTICLE DETAIL PANEL â•â•â• -->
  <div id="detail-overlay" class="overlay hidden"></div>
  <div id="detail-panel" class="side-panel hidden">
    <div class="panel-header">
      <span class="panel-badge" id="detail-source"></span>
      <span class="panel-badge" id="detail-category"></span>
      <button id="detail-close" class="icon-btn" title="Close (Esc)">âœ•</button>
    </div>
    <div class="panel-body">
      <h2 id="detail-title"></h2>
      <div class="detail-meta">
        <span id="detail-author"></span>
        <span id="detail-time"></span>
        <span id="detail-score"></span>
      </div>
      <img id="detail-image" class="detail-img hidden" alt="">
      <p id="detail-snippet"></p>
      <div class="detail-actions">
        <a id="detail-link" href="#" target="_blank" rel="noopener" class="btn">OPEN SOURCE â†—</a>
        <a id="detail-comments-link" href="#" target="_blank" rel="noopener" class="btn btn-outline">DISCUSSION â†—</a>
        <button id="detail-save" class="btn btn-outline">â˜† SAVE</button>
        <button id="detail-share" class="btn btn-outline" title="Share / Copy link">â˜ SHARE</button>
      </div>
      <div class="detail-reactions">
        <button id="detail-like" class="react-btn" title="Like â€” boost similar content">ğŸ‘ LIKE</button>
        <button id="detail-dislike" class="react-btn" title="Dislike â€” show less like this">ğŸ‘ DISLIKE</button>
        <button id="detail-showless" class="react-btn" title="Show less from this source">ğŸ“‰ SHOW LESS</button>
        <button id="detail-block" class="react-btn react-danger" title="Block â€” never show again">ğŸš« BLOCK</button>
      </div>
      <div id="detail-discussion" class="detail-discussion">
        <h3 class="discussion-header">ğŸ’¬ DISCUSSION</h3>
        <div id="discussion-loading" class="discussion-loading hidden">Scanning threads...</div>
        <div id="discussion-list" class="discussion-list"></div>
        <div id="discussion-empty" class="discussion-empty hidden">No discussion data available for this source.</div>
      </div>
    </div>
  </div>

  <!-- â•â•â• SETTINGS PANEL â•â•â• -->
  <div id="settings-overlay" class="overlay hidden"></div>
  <div id="settings-panel" class="side-panel hidden">
    <div class="panel-header">
      <h2>âš™ CONFIGURATION</h2>
      <button id="settings-close" class="icon-btn">âœ•</button>
    </div>
    <div class="panel-body">
      <div class="setting-group">
        <label>Auto-refresh interval (seconds)</label>
        <input type="number" id="setting-refresh" value="120" min="30" max="600" step="10">
      </div>
      <div class="setting-group">
        <label>CRT Scanline Effect</label>
        <label class="switch">
          <input type="checkbox" id="setting-crt" checked>
          <span>Enabled</span>
        </label>
      </div>
      <div class="setting-group setting-account">
        <h3>ğŸ‘¤ Account</h3>
        <p class="hint" id="setting-auth-hint">Sign in to sync preferences across devices.</p>
        <button id="setting-auth-btn" class="btn">â–¸ SIGN IN / SIGN UP</button>
      </div>
      <div class="setting-group">
        <label>Radar Sound</label>
        <label class="switch">
          <input type="checkbox" id="setting-sound">
          <span>Enabled</span>
        </label>
      </div>
      <div class="setting-group">
        <label>Local News Region</label>
        <select id="setting-country">
          <option value="auto">Auto-detect</option>
          <option value="us">ğŸ‡ºğŸ‡¸ United States</option>
          <option value="gb">ğŸ‡¬ğŸ‡§ United Kingdom</option>
          <option value="ca">ğŸ‡¨ğŸ‡¦ Canada</option>
          <option value="au">ğŸ‡¦ğŸ‡º Australia</option>
          <option value="de">ğŸ‡©ğŸ‡ª Germany</option>
          <option value="fr">ğŸ‡«ğŸ‡· France</option>
          <option value="in">ğŸ‡®ğŸ‡³ India</option>
          <option value="jp">ğŸ‡¯ğŸ‡µ Japan</option>
          <option value="br">ğŸ‡§ğŸ‡· Brazil</option>
          <option value="za">ğŸ‡¿ğŸ‡¦ South Africa</option>
          <option value="ng">ğŸ‡³ğŸ‡¬ Nigeria</option>
          <option value="ae">ğŸ‡¦ğŸ‡ª UAE</option>
          <option value="sg">ğŸ‡¸ğŸ‡¬ Singapore</option>
          <option value="kr">ğŸ‡°ğŸ‡· South Korea</option>
          <option value="mx">ğŸ‡²ğŸ‡½ Mexico</option>
          <option value="it">ğŸ‡®ğŸ‡¹ Italy</option>
          <option value="es">ğŸ‡ªğŸ‡¸ Spain</option>
          <option value="nl">ğŸ‡³ğŸ‡± Netherlands</option>
          <option value="se">ğŸ‡¸ğŸ‡ª Sweden</option>
          <option value="pl">ğŸ‡µğŸ‡± Poland</option>
          <option value="ph">ğŸ‡µğŸ‡­ Philippines</option>
        </select>
        <p class="hint">Adds local headlines from your selected region.</p>
      </div>
      <div class="setting-group">
        <label>Radar Sweep Speed</label>
        <select id="setting-radar-speed">
          <option value="slow">Slow</option>
          <option value="normal" selected>Normal</option>
          <option value="fast">Fast</option>
        </select>
      </div>
      <div class="setting-group">
        <h3>ğŸ“¡ Subreddit Sources</h3>
        <p class="hint">Toggle subreddits to tailor your feed. More subs = more signals.</p>
        <div class="sub-counter"><span id="sub-count">0</span> active sources</div>
        <div id="sub-manager"></div>
        <div class="sub-custom-add">
          <input type="text" id="sub-custom-input" placeholder="r/subreddit" spellcheck="false" autocomplete="off">
          <button id="sub-custom-btn" class="btn">+ ADD</button>
        </div>
      </div>
      <div class="setting-group">
        <h3>Interest Profile</h3>
        <p class="hint">Your click patterns shape the ranking algorithm</p>
        <div id="interest-chart"></div>
      </div>
      <div class="setting-group" id="saved-settings-section">
        <h3>â˜… Saved Intelligence</h3>
        <p class="hint">Your bookmarked articles are stored here.</p>
        <div id="saved-header-inline" style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;">
          <span id="saved-count-label" style="font-size:13px;color:var(--text-dim);">0 saved items</span>
          <button id="clear-saved" class="btn-sm">PURGE ALL</button>
        </div>
        <div id="saved-list" style="max-height:300px;overflow-y:auto;"></div>
        <div id="saved-empty" class="empty-state" style="padding:20px 10px;">
          <p>[ NO SAVED INTEL ]</p>
          <p class="hint">Bookmark articles from any view to cache them here.</p>
        </div>
      </div>
      <div class="setting-group" id="shortcuts">
        <h3>Keyboard Shortcuts</h3>
        <div class="shortcuts-list">
          <div><kbd>R</kbd> Radar view</div>
          <div><kbd>F</kbd> Feed view</div>
          <div><kbd>M</kbd> Map view</div>
          <div><kbd>C</kbd> Events view</div>
          <div><kbd>/</kbd> Focus search</div>
          <div><kbd>Esc</kbd> Close panels</div>
        </div>
      </div>

      <div class="setting-group">
        <button id="setting-clear-data" class="btn btn-danger">âš  WIPE ALL LOCAL DATA</button>
      </div>
    </div>
  </div>

  <!-- â•â•â• AUTH MODAL â•â•â• -->
  <div id="auth-overlay" class="overlay hidden"></div>
  <div id="auth-modal" class="auth-modal hidden">
    <div class="auth-header">
      <span>â–“ AUTHENTICATE</span>
      <button id="auth-modal-close" class="icon-btn">âœ•</button>
    </div>
    <div class="auth-tabs" id="auth-tabs">
      <button class="auth-tab active" data-tab="signin">SIGN IN</button>
      <button class="auth-tab" data-tab="signup">SIGN UP</button>
    </div>
    <form id="auth-form" autocomplete="off">
      <div class="auth-field">
        <label>EMAIL</label>
        <input type="email" id="auth-email" required spellcheck="false" placeholder="operator@sentinel.io">
      </div>
      <div class="auth-field">
        <label>PASSWORD</label>
        <input type="password" id="auth-password" required minlength="6" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
      </div>
      <button type="submit" class="auth-submit">â–¸ AUTHENTICATE</button>
      <div id="auth-status" class="auth-status">> Awaiting credentials...</div>
    </form>
    <div id="auth-user-info" class="auth-user-info hidden">
      <div class="auth-user-avatar" id="auth-user-avatar"></div>
      <div class="auth-user-email" id="auth-user-email"></div>
      <div class="auth-user-since" id="auth-user-since">Session active</div>
      <div class="auth-sync-label" id="auth-sync-status">â˜ Synced to cloud</div>

      <!-- Profile Icon Chooser -->
      <div class="auth-section">
        <div class="auth-section-label">â—ˆ PROFILE ICON</div>
        <div class="avatar-chooser" id="avatar-chooser"></div>
      </div>

      <!-- Change Password -->
      <div class="auth-section">
        <div class="auth-section-label">â—ˆ CHANGE PASSWORD</div>
        <div class="auth-pw-form" id="auth-pw-form">
          <input type="password" id="pw-new" placeholder="New password" minlength="6" autocomplete="new-password">
          <input type="password" id="pw-confirm" placeholder="Confirm password" minlength="6" autocomplete="new-password">
          <button id="pw-change-btn" class="btn btn-outline">â–¸ UPDATE PASSWORD</button>
          <div id="pw-status" class="auth-status"></div>
        </div>
      </div>

      <button id="auth-signout" class="btn btn-danger">â—‰ SIGN OUT</button>
    </div>
  </div>

  <!-- â•â•â• STATUS BAR â•â•â• -->
  <footer id="status-bar">
    <span id="status-connection">â— ONLINE</span>
    <span id="status-sources">Sources: â€”</span>
    <span id="status-items">Signals: â€”</span>
    <span id="status-region">Region: â€”</span>
    <span id="status-refresh">Next scan: â€”</span>
    <a href="/about.html" class="status-about" title="About Sentinel">â“˜ ABOUT</a>
    <span id="status-time" class="status-right"></span>
  </footer>

  <!-- â•â•â• MOBILE BOTTOM NAV â•â•â• -->
  <nav id="mobile-nav">
    <button class="mobile-nav-btn active" data-view="radar">
      <span class="mnav-icon">â—‰</span>
      <span class="mnav-label">Radar</span>
    </button>
    <button class="mobile-nav-btn" data-view="feed">
      <span class="mnav-icon">â‰¡</span>
      <span class="mnav-label">Feed</span>
    </button>
    <button class="mobile-nav-btn" data-view="map">
      <span class="mnav-icon">âŠ•</span>
      <span class="mnav-label">Map</span>
    </button>
    <button class="mobile-nav-btn" data-view="calendar">
      <span class="mnav-icon">â–£</span>
      <span class="mnav-label">Events</span>
    </button>
  </nav>

  <!-- â•â•â• SCRIPTS â•â•â• -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <!-- Landing map renderer (must load before inline landing script) -->
  <script src="/js/landing-map.js"></script>

  <!-- Landing page logic (runs before main app) -->
  <script>
  (function() {
    const SEEN_KEY = 'sentinel_seen_landing';
    const landing = document.getElementById('landing');
    const seen = localStorage.getItem(SEEN_KEY);

    if (seen) {
      // Returning user â€” skip landing entirely
      landing.classList.add('hidden');
      document.body.classList.remove('landing-active');
    } else {
      document.body.classList.add('landing-active');
      initLandingRadar();
      LandingMap.init(document.getElementById('landing-map-canvas'));
      initMatrixRain();
    }

    function enterApp() {
      localStorage.setItem(SEEN_KEY, '1');
      landing.classList.add('dismissed');
      document.body.classList.remove('landing-active');
      LandingMap.stop();
      setTimeout(() => landing.classList.add('hidden'), 650);
    }

    document.getElementById('landing-enter')?.addEventListener('click', enterApp);
    document.addEventListener('keydown', function onKey(e) {
      if (!landing.classList.contains('hidden') && !landing.classList.contains('dismissed')) {
        if (e.key === 'Enter') {
          e.preventDefault();
          enterApp();
          document.removeEventListener('keydown', onKey);
        }
      }
    });

    /* Mini radar canvas animation for the landing background */
    function initLandingRadar() {
      const c = document.getElementById('landing-radar');
      if (!c) return;
      const ctx = c.getContext('2d');
      const size = 600;
      c.width = size; c.height = size;
      let angle = 0;

      function draw() {
        if (landing.classList.contains('hidden')) return;
        const cx = size / 2, cy = size / 2, r = size * 0.46;

        ctx.clearRect(0, 0, size, size);

        // Rings
        ctx.strokeStyle = 'rgba(0,255,65,0.12)';
        ctx.lineWidth = 0.8;
        for (let i = 1; i <= 4; i++) {
          ctx.beginPath();
          ctx.arc(cx, cy, r * (i / 4), 0, Math.PI * 2);
          ctx.stroke();
        }

        // Cross hairs
        ctx.strokeStyle = 'rgba(0,255,65,0.07)';
        ctx.beginPath();
        ctx.moveTo(cx - r, cy); ctx.lineTo(cx + r, cy);
        ctx.moveTo(cx, cy - r); ctx.lineTo(cx, cy + r);
        ctx.stroke();

        // Sweep gradient
        const grad = ctx.createConicalGradient
          ? null // fallback below
          : null;

        // Sweep arc (trailing glow)
        for (let i = 0; i < 30; i++) {
          const a = angle - (i * 0.02);
          const alpha = (1 - i / 30) * 0.35;
          ctx.strokeStyle = `rgba(0,255,65,${alpha})`;
          ctx.lineWidth = 2;
          ctx.beginPath();
          ctx.moveTo(cx, cy);
          ctx.lineTo(cx + Math.cos(a) * r, cy + Math.sin(a) * r);
          ctx.stroke();
        }

        // Sweep line (bright)
        ctx.strokeStyle = 'rgba(0,255,65,0.8)';
        ctx.lineWidth = 1.5;
        ctx.beginPath();
        ctx.moveTo(cx, cy);
        ctx.lineTo(cx + Math.cos(angle) * r, cy + Math.sin(angle) * r);
        ctx.stroke();

        // Center dot
        ctx.fillStyle = 'rgba(0,255,65,0.5)';
        ctx.beginPath();
        ctx.arc(cx, cy, 3, 0, Math.PI * 2);
        ctx.fill();

        // Some fake blips
        const blips = [
          { a: 0.8, d: 0.3 }, { a: 2.1, d: 0.6 }, { a: 3.5, d: 0.45 },
          { a: 4.8, d: 0.75 }, { a: 5.5, d: 0.2 }, { a: 1.2, d: 0.85 }
        ];
        blips.forEach(b => {
          const diff = ((angle - b.a) % (Math.PI * 2) + Math.PI * 2) % (Math.PI * 2);
          const glow = diff < 0.8 ? (1 - diff / 0.8) * 0.7 : 0.15;
          ctx.fillStyle = `rgba(0,255,65,${glow})`;
          ctx.beginPath();
          ctx.arc(cx + Math.cos(b.a) * r * b.d, cy + Math.sin(b.a) * r * b.d, 3, 0, Math.PI * 2);
          ctx.fill();
        });

        angle += 0.008;
        if (angle > Math.PI * 2) angle -= Math.PI * 2;
        requestAnimationFrame(draw);
      }
      draw();
    }

    /* Matrix rain background for mobile */
    function initMatrixRain() {
      const mc = document.getElementById('matrix-rain');
      if (!mc) return;
      // Only run on mobile-sized screens
      if (window.innerWidth > 900) return;
      const mctx = mc.getContext('2d');

      mc.width = window.innerWidth;
      mc.height = window.innerHeight;
      window.addEventListener('resize', () => {
        mc.width = window.innerWidth;
        mc.height = window.innerHeight;
      });

      const chars = '01234567890ABCDEF!@#$%^&*<>{}[]|/\\';
      const fontSize = 14;
      const columns = Math.floor(mc.width / fontSize);
      const drops = [];
      for (let i = 0; i < columns; i++) {
        drops[i] = Math.floor(Math.random() * -50);
      }

      function drawMatrix() {
        if (landing.classList.contains('hidden')) return;

        // Trail fade
        mctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
        mctx.fillRect(0, 0, mc.width, mc.height);

        mctx.font = fontSize + 'px monospace';

        for (let i = 0; i < drops.length; i++) {
          if (drops[i] < 0) {
            drops[i] += 0.3;
            continue;
          }

          const char = chars[Math.floor(Math.random() * chars.length)];
          const x = i * fontSize;
          const y = Math.floor(drops[i]) * fontSize;

          // Bright head character
          mctx.fillStyle = 'rgba(0, 255, 65, 0.35)';
          mctx.fillText(char, x, y);

          // Slightly dimmer trail character one step above
          if (y > fontSize) {
            const trailChar = chars[Math.floor(Math.random() * chars.length)];
            mctx.fillStyle = 'rgba(0, 255, 65, 0.15)';
            mctx.fillText(trailChar, x, y - fontSize);
          }

          if (drops[i] * fontSize > mc.height && Math.random() > 0.98) {
            drops[i] = Math.floor(Math.random() * -20);
          }
          drops[i] += 0.4;
        }
        requestAnimationFrame(drawMatrix);
      }
      drawMatrix();
    }
  })();
  </script>

  <script src="/js/store.js"></script>
  <script src="/js/api.js"></script>
  <script src="/js/auth.js"></script>
  <script src="/js/radar.js"></script>
  <script src="/js/worldmap.js"></script>
  <script src="/js/timeline.js"></script>
  <script src="/js/calendar.js"></script>
  <script src="/js/app.js"></script>

</body>
</html>
